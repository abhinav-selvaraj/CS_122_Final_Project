{% extends "base.html" %}

{% block content %}
<main>

    <a href="/RawData/AAPL"><button>Navigate to Data Table</Table></button></a>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"> </script>
        <!-- Stock Selection Dropdown -->
        <form>
            <label for="symbol">Stock Name:</label>
            <select id="symbol" name="symbol" required onchange="changeData()">
                {% for symbol in symbols %}
                <option value="{{ symbol }}">{{ symbol }}</option>
                {% endfor %}
            </select>

        </form>
        
        <canvas id="stockChart" style="width:100%;max-width:1000px"></canvas>
        <script>
            const xValues = [];
            const openValues = [];
            const highValues = [];
            const lowValues = [];
            const closeValues =[];
            const volumeValues = [];

            {% for date, data in data['Time Series (Daily)'].items() %}
                
                xValues.push("{{ date[5:]}}");
                openValues.push("{{data['1. open']}}");
                highValues.push("{{ data['2. high'] }}")
                lowValues.push("{{ data['3. low'] }}")
                closeValues.push("{{ data['4. close'] }}")
                volumeValues.push("{{ data['5. volume'] }}")
            {% endfor %}

            xValues.reverse();
            openValues.reverse();
            highValues.reverse();
            lowValues.reverse();
            closeValues.reverse();
            volumeValues.reverse();
            new Chart("stockChart", {
                type: "line",
                data: {
                    labels: xValues,
                    
                    datasets: [
                        //Open Values = Gray
                        {
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(108,122,137,.5)",
                            borderColor: "rgba(108,122,137,.5)",
                            pointRadius: 2,
                            data: openValues,
                            showLine:false
                        },
                        //High Values = Red
                        {
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(100,0,0,.5)",
                            borderColor: "rgba(100,0,0,.5)",
                            pointRadius: 2,
                            data: highValues,
                            showLine:false
                        },
                        //Low Values = Blue
                        {
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(0,0,100,.5)",
                            borderColor: "rgba(0,0,100,.5)",
                            pointRadius: 2,
                            data: lowValues,
                            showLine:false
                        },

                        //Close Values = Green
                        {
                            fill: false,
                            lineTension: 0,
                            backgroundColor: "rgba(0,100,0,1)",
                            borderColor: "rgba(0,100,0,1)",
                            pointRadius: 2,
                            data: closeValues
                        },
                    
                        

                ]
                },
                options: {
                    legend: { display: false },
                    scales: {
                        
                        yAxes: [{ ticks: { min: 115, max: 150, stepSize:1 } }],
                    }
                }
            });
        </script>




</main>
{% endblock %}